<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird Clone</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* Custom CSS for a retro game feel */
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #1a1a2e; /* Dark background */
            font-family: 'Press Start 2P', cursive;
            color: #fff;
            overflow: hidden;
        }

        .game-container {
            position: relative;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            border: 8px solid #3c009d; /* Purple border */
            border-radius: 12px;
            overflow: hidden;
            background: linear-gradient(to bottom, #74b9ff, #005f99); /* Sky gradient */
            max-width: 90vw;
            max-height: 90vh;
        }

        canvas {
            display: block;
            background-color: transparent;
            touch-action: manipulation; /* Improves mobile responsiveness */
        }

        #score-display {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            font-size: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            z-index: 10;
            padding: 5px;
        }

        #message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.85);
            border: 4px solid #ffcc00; /* Gold border */
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            z-index: 20;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.7);
        }

        #message-box.active {
            opacity: 1;
            visibility: visible;
        }

        #message-box h2 {
            margin-top: 0;
            color: #ffcc00;
            font-size: 1.2rem;
        }

        #message-box p {
            font-size: 0.8rem;
            line-height: 1.5;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            #score-display {
                font-size: 1rem;
            }
            #message-box h2 {
                font-size: 1rem;
            }
            #message-box p {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <div id="score-display">Score: 0</div>
        <canvas id="gameCanvas"></canvas>
        <div id="message-box">
            <h2 id="message-title">RESIDENT RAVER</h2>
            <p id="message-text">Press SPACE or tap the screen to start and jump!</p>
        </div>
    </div>

    <script>
        // --- Canvas Setup ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score-display');
        const messageBox = document.getElementById('message-box');
        const messageTitle = document.getElementById('message-title');
        const messageText = document.getElementById('message-text');

        // Set initial canvas dimensions (responsive sizing in JS)
        const CANVAS_WIDTH = 480;
        const CANVAS_HEIGHT = 640;
        canvas.width = CANVAS_WIDTH;
        canvas.height = CANVAS_HEIGHT;

        // --- Game Constants ---
        const GRAVITY = 0.6;
        const JUMP_STRENGTH = -10;
        const PIPE_WIDTH = 60;
        const PIPE_GAP_HEIGHT = 150;
        const PIPE_SPEED = 3;
        const BIRD_RADIUS = 15;
        const PIPE_INTERVAL = 120; // Frames between pipe generation

        // --- Ground Constants for scrolling background ---
        const GROUND_HEIGHT = 80;
        const GROUND_COLOR = '#d2b48c'; // Tan/Brown base
        const GRASS_COLOR = '#4a7526'; // Green top

        // --- Game State ---
        let score = 0;
        let highScore = 0;
        let isPlaying = false;
        let frameCount = 0;
        let pipes = [];
        let bird;
        let gameLoopId;
        let groundX = 0; // For ground scrolling

        // --- Bird Object ---
        const Bird = {
            x: CANVAS_WIDTH / 4,
            y: CANVAS_HEIGHT / 2,
            velocity: 0,
            radius: BIRD_RADIUS,
            color: '#ffdd00', // Yellow
            wingColor: '#ff8800', // Orange
            eyeColor: '#000000',

            draw() {
                // Main body (circle)
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.strokeStyle = '#990000';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Beak (triangle)
                ctx.fillStyle = '#ff5500';
                ctx.beginPath();
                ctx.moveTo(this.x + this.radius, this.y - 5);
                ctx.lineTo(this.x + this.radius + 10, this.y);
                ctx.lineTo(this.x + this.radius, this.y + 5);
                ctx.fill();

                // Eye (small black circle)
                ctx.beginPath();
                ctx.arc(this.x + 5, this.y - 5, 3, 0, Math.PI * 2);
                ctx.fillStyle = this.eyeColor;
                ctx.fill();
            },

            update() {
                this.velocity += GRAVITY;
                this.y += this.velocity;
            },

            jump() {
                this.velocity = JUMP_STRENGTH;
            }
        };

        // --- Pipe Class ---
        class Pipe {
            constructor(gapY) {
                this.x = CANVAS_WIDTH;
                this.width = PIPE_WIDTH;
                this.gapY = gapY; // Center of the gap
                this.gapHeight = PIPE_GAP_HEIGHT;
                this.color = '#38761d'; // Dark Green
                this.passed = false; // Flag to check if the bird passed it
            }

            draw() {
                // Pipe body color
                ctx.fillStyle = this.color;
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;

                // Top Pipe (Draws from 0 to gapY - half gap height)
                const topPipeHeight = this.gapY - this.gapHeight / 2;
                ctx.fillRect(this.x, 0, this.width, topPipeHeight);
                ctx.strokeRect(this.x, 0, this.width, topPipeHeight);

                // Bottom Pipe (Draws from gapY + half gap height to CANVAS_HEIGHT)
                const bottomPipeY = this.gapY + this.gapHeight / 2;
                const bottomPipeHeight = CANVAS_HEIGHT - bottomPipeY;
                ctx.fillRect(this.x, bottomPipeY, this.width, bottomPipeHeight);
                ctx.strokeRect(this.x, bottomPipeY, this.width, bottomPipeHeight);

                // Pipe caps (for better visual)
                ctx.fillStyle = '#59a334'; // Lighter green cap
                const capHeight = 15;
                // Top cap
                ctx.fillRect(this.x - 5, topPipeHeight - capHeight, this.width + 10, capHeight);
                ctx.strokeRect(this.x - 5, topPipeHeight - capHeight, this.width + 10, capHeight);
                // Bottom cap
                ctx.fillRect(this.x - 5, bottomPipeY, this.width + 10, capHeight);
                ctx.strokeRect(this.x - 5, bottomPipeY, this.width + 10, capHeight);
            }

            update() {
                this.x -= PIPE_SPEED;
            }
        }

        // --- Background/Ground Drawing Logic ---

        function drawGround() {
            const groundY = CANVAS_HEIGHT - GROUND_HEIGHT;

            // Draw the ground base (scrolling effect is achieved by the continuous re-draw)
            ctx.fillStyle = GROUND_COLOR;
            ctx.fillRect(0, groundY, CANVAS_WIDTH, GROUND_HEIGHT);

            // Draw the grass line (cap)
            ctx.fillStyle = GRASS_COLOR;
            const grassCapHeight = 15;
            ctx.fillRect(0, groundY - grassCapHeight, CANVAS_WIDTH, grassCapHeight);
            
            // Scroll the ground texture using groundX
            groundX -= PIPE_SPEED;
            if (groundX <= -30) { 
                groundX = 0;
            }

            // Draw simple scrolling vertical lines as texture on the grass cap
            ctx.fillStyle = '#3c5d21'; // Darker grass texture color
            for (let i = groundX; i < CANVAS_WIDTH; i += 30) {
                ctx.fillRect(i, groundY - grassCapHeight, 5, grassCapHeight);
            }

            // Optional: Draw road texture on the brown area
            ctx.fillStyle = '#b09069'; // Lighter brown/dirt texture
             for (let i = groundX; i < CANVAS_WIDTH * 2; i += 60) {
                ctx.fillRect(i, groundY + 20, 10, 5);
            }
        }

        // --- Game Logic Functions ---

        function checkCollision() {
            const groundYCollision = CANVAS_HEIGHT - GROUND_HEIGHT - BIRD_RADIUS;

            // 1. Wall/Ground Collision (Top/Bottom)
            if (bird.y >= groundYCollision || bird.y - bird.radius < 0) {
                return true;
            }

            // 2. Pipe Collision
            for (const pipe of pipes) {
                // Check if pipe is in the bird's horizontal range
                if (bird.x + bird.radius > pipe.x && bird.x - bird.radius < pipe.x + pipe.width) {
                    // Check top pipe collision
                    const topPipeCollision = bird.y - bird.radius < pipe.gapY - pipe.gapHeight / 2;
                    // Check bottom pipe collision
                    const bottomPipeCollision = bird.y + bird.radius > pipe.gapY + pipe.gapHeight / 2;

                    if (topPipeCollision || bottomPipeCollision) {
                        return true;
                    }
                }
            }
            return false;
        }

        function spawnPipe() {
            // Random Y coordinate for the center of the gap
            // Ensure pipe gap respects the ground height and top boundary
            const minGapY = 150;
            const maxGapY = CANVAS_HEIGHT - GROUND_HEIGHT - 50; 
            const gapY = Math.random() * (maxGapY - minGapY) + minGapY;
            pipes.push(new Pipe(gapY));
        }

        function updateScore() {
            for (const pipe of pipes) {
                // Check if the bird has passed the pipe center
                // Bird's X position is constant, check if the pipe's trailing edge passes it
                if (pipe.x + pipe.width < bird.x - bird.radius && !pipe.passed) {
                    score++;
                    pipe.passed = true;
                }
            }
            scoreDisplay.textContent = `Score: ${score}`;
        }

        function resetGame() {
            pipes = [];
            score = 0;
            Bird.y = CANVAS_HEIGHT / 2;
            Bird.velocity = 0;
            isPlaying = false;
            frameCount = 0;
            groundX = 0; // Reset ground scroll position
            scoreDisplay.textContent = `Score: 0`;

            // Show start message
            highScore = Math.max(highScore, score);
            messageTitle.textContent = "RESIDENT RAVER";
            messageText.innerHTML = `High Score: ${highScore}<br>Press SPACE or tap to play!`;
            messageBox.classList.add('active');
        }

        function startGame() {
            if (isPlaying) return;
            isPlaying = true;
            score = 0;
            pipes = [];
            Bird.y = CANVAS_HEIGHT / 2; // Reset position
            Bird.velocity = 0;
            messageBox.classList.remove('active');
            frameCount = 0;
            groundX = 0;
            if (gameLoopId) cancelAnimationFrame(gameLoopId);
            gameLoop();
        }

        function gameOver() {
            isPlaying = false;
            highScore = Math.max(highScore, score);
            messageTitle.textContent = "GAME OVER!";
            messageText.innerHTML = `Your Score: ${score}<br>High Score: ${highScore}<br>Press SPACE or tap to restart!`;
            messageBox.classList.add('active');
            if (gameLoopId) cancelAnimationFrame(gameLoopId);
        }

        // --- Main Game Loop ---
        function gameLoop() {
            if (!isPlaying) return;

            // Clear the canvas (sky gradient is handled by CSS background of the game-container)
            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // 1. Update logic
            bird.update();
            pipes.forEach(pipe => {
                pipe.update();
            });

            // 2. Collision check
            if (checkCollision()) {
                gameOver();
                return;
            }

            // 3. Drawing order: Pipes -> Ground -> Bird (Bird overlays the ground)
            pipes.forEach(pipe => {
                pipe.draw();
            });

            drawGround(); // Draw the scrolling ground

            bird.draw(); // Draw the bird

            // 4. Pipe spawning and cleaning
            frameCount++;
            if (frameCount % PIPE_INTERVAL === 0) {
                spawnPipe();
            }
            pipes = pipes.filter(pipe => pipe.x + pipe.width > 0);
            updateScore();

            // Request next frame
            gameLoopId = requestAnimationFrame(gameLoop);
        }

        // --- Event Listeners ---

        function handleJump(event) {
            // Filter input types
            if (event.type === 'keydown') {
                if (event.code !== 'Space') return;
                event.preventDefault(); // Stop page scrolling with space
            } else if (event.type === 'mousedown') {
                if (event.button !== 0) return; // Only respond to left mouse button
            }
            
            // Logic
            if (!isPlaying) {
                startGame();
                bird.jump(); // Jump immediately upon starting so we don't fall instantly
            } else {
                bird.jump();
            }
        }

        // Keyboard input (Spacebar)
        window.addEventListener('keydown', handleJump);

        // Mouse/Touch input (Click/Tap anywhere on the screen)
        // CHANGED: Attached to document so UI overlays (like Game Over text) don't block clicks
        document.addEventListener('mousedown', handleJump);
        document.addEventListener('touchstart', (e) => {
            // Prevent default touch actions (scrolling/zooming) while playing
            e.preventDefault(); 
            handleJump(e);
        }, { passive: false });

        // --- Initialization ---
        window.onload = function() {
            bird = Bird;
            resetGame(); // Show initial message and set up bird
        };
    </script>
</body>
</html>